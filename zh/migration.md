## 마이그레이션 가이드

### 개요 
2020년 3월 24일  10:00:00 KST 정기점검  이전에 생성한 `[서비스ID].cdn.toastcloud.com` 도메인의 CDN 서비스는 2020년 5월 26일 10:00:00 KST 까지 서비스가 제공됩니다.
서비스 제공 기간 이후 `[서비스ID].cdn.toastcloud.com` 도메인의 CDN 서비스는 종료됩니다. 

종료된 이 후에는 아래의 작업이 불가합니다.
- CDN 서비스 도메인으로 콘텐츠 요청을 할 수 없습니다.
- 콘솔과 API를 통해 서비스 조작이 불가합니다. 

CDN 서비스를 계속 이용하려면 이 문서의 마이그레이션 가이드를 통해 CDN 서비스를 마이그레이션 하시기 바랍니다.


### 마이그레이션 방법

#### 1. CDN 서비스 마이그레이션 
1. TOAST CDN 콘솔 페이지의 **[CDN 서비스]** 탭으로 이동합니다. 
2. CDN 서비스 목록 중 마이그레이션 대상인 `[서비스ID].cdn.toastcloud.com` 서비스 이름 옆에 위치한 **[마이그레이션]** 버튼을 클릭합니다. 

3. **[마이그레이션]** 버튼을 클릭하면 CDN 서비스 생성 화면이 표시됩니다. CDN 서비스 생성화면은 기존 CDN 서비스 설정 정보가 기본으로 설정되어 있습니다. 

#### 2. CDN 서비스 설정 확인
CDN 서비스 생성 화면에서 CDN 서비스를 생성 하기 전 CDN 서비스 설정이 올바른지 확인합니다. 
아래의 가이드 내용을 참고 하여 설정을 변경 하신 후 **[확인]** 버튼을 클릭하여 CDN 서비스를 생성합니다. 
생성된 CDN 서비스는 `[서비스ID].toastcdn.net` 도메인으로 생성됩니다. 

1. **서비스 지역** 
    - KOREA (한국) 서비스 지역을 지원하지 않습니다. 
    - 한국 지역을 포함하고 있는 GLOBAL 서비스 지역만 제공됩니다. 
    - **중국과 러시아** 국가 지역은 GLOBAL 서비스 지역에 포함되지 않습니다. 

2. **도메인 별칭** 
    - 기존 도메인 별칭의 도메인으로 HTTPS 프로토콜 서비스를 이용 중인 경우
        - CDN 서비스를 생성 하기 전 **[인증서 관리]** 탭에서 **[신규 인증서 발급]** 버튼을 클릭하여 먼저 인증서를 발급 하시기 바랍니다. 인증서 발급을 하지 않은 경우 HTTPS 프로토콜 서비스를 이용할 경우 인증서 오류가 발생합니다. 

3. **원본 서버**
    - 기존 CDN 서비스는 HTTP 프로토콜만 지원 가능했으나 신규 CDN 서비스는 `*.toastcdn.net` 서비스 도메인은 HTTP/HTTPS 프로토콜을 모두 지원합니다. 도메인 별칭의 도메인은 인증서 관리 탭에서 인증서 발급 후 HTTPS 서비스 프로토콜이 사용 가능합니다. 
   
    - 원본 서버 포트: 원본 서버의 운영 중인 HTTP/HTTPS 포트 번호를 설정합니다. 설정하지 않으면 미설정으로 표시되며, 기본 포트(HTTP:80, HTTPS:443)으로 설정됩니다.  

    - CDN 서비스 도메인(또는 도메인 별칭) HTTPS 프로토콜 요청을 지원하려면 원본 서버는 HTTPS 프로토콜을 지원해야 합니다. 
    - HTTPS 적용 시 'man-in-the-middle(MITM)' 공격을 예방하기 위해 원본 서버의 인증서 유효 여부를 확인합니다. 아래와 같은 Certification Authority(CA)로부터 발급받은 인증서에 대해 유효성이 확인된 후 통신이 가능하니 참고 부탁드립니다.
    - 만일 원본 서버가 HTTPS 응답을 지원하기 어려운 경우, **원본 요청 HTTP 프로토콜 다운그레이드** 설정을 이용 하시기 바랍니다. 단 이 설정은 제약 사항이 있으므로 해당 내용을 반드시 확인 하시기 바랍니다. 

4. **원본 요청 HTTP 프로토콜 다운그레이드**
    - 원본 서버가 HTTP 응답만 지원 가능한 경우, 원본 요청 HTTP 프로토콜 다운그레이드 설정을 "사용"으로 설정합니다. 
    - 원본 요청 HTTP 프로토콜 다운그레이드을 "사용"으로 설정한 경우, CDN 서버 -> 원본 요청시 HTTPS 프로토콜 요청은 HTTP 프로토콜로 다운그레이드 하여 요청합니다. 
    - 단, 이 설정은 다음과 같은 제약 사항이 있으므로 주의하여 사용하시기 바랍니다. 
        1. 전체 사이트 주소는 프로토콜 다운 그레이드가 불가합니다. (예: 원본 서버의 전체 사이트 주소인 "www.toast.com"는 다운그레이드 불가합니다. "www.toast.com/index.html" )
        2. GET, HEAD 및 OPTIONS 메소드 외 메서드는 지원되지 않습니다. 
        3. CDN 서버에서 원본 서버로 다운그레이드 요청시 다음의 헤더는 제외될 수 있습니다.
            - Origin, Referer, Cookie, Cookie2, sec-, proxy-

5. **Forward Host Header** 
CDN 서버가 원본 서버에 원본 파일을 요청시 전달 할 `Host` 헤더 값을 설정합니다. 
원본 서버가 Name-based virtual host로 운영 중이라면 `Request Host Header` 설정이 필요할 수 있습니다. 원본 서버의 운영 형태에 따라 적합한 설정 값을 선택하시기 바랍니다.
    - Origin Hostname: 원본 서버의 호스트네임을 Host 헤더로 설정합니다. 
    - Request Host Header: 클라이언트 요청의 Host 헤더로 설정합니다.

6. 캐시 
원본 서버의 Cache Control 응답 헤더를 통해 캐시를 설정 할 수 있습니다. 
* **원본 설정 사용**: 원본 서버의 응답에서 제공한 캐시 제어 헤더(Cache-Control, Expires)를 우선하여 적용합니다. 만일 원본 서버의 응답에 캐시 제어 헤더(Cache-Control, Expires)가 유효하지 않거나 없는 경우, 캐시 만료 시간(초)에 지정한 시간 동안 캐싱합니다.  **원본 설정 사용** 옵션이 기본값입니다.
* **사용자 설정 사용**: 캐시 만료 시간(초)에 지정한 시간 동안 캐싱합니다. 


#### 3.신규 생성한 CDN 서비스 테스트

[신규 CDN 서비스 테스트 방법 내용]


#### 4.CDN 서비스 운영 변경 

[CDN 서비스 운영 변경 방법]

#### 5.기존 CDN 서비스 삭제 
모든 CDN 서비스를 마이그레이션 작업을 완료 했다면 `[서비스ID].cdn.toastcloud.com` 서비스를 삭제합니다. 













